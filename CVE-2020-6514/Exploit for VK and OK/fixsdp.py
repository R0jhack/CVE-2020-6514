import frida
import sys

package_name = "com.vkontakte.android"



def on_message(message, data):
    if message['type'] == 'send':
        print("[*] {0}".format(message['payload']))
    else:
        print(message)

jscode = """

Java.perform(function () {

  var pc = Java.use('org.webrtc.PeerConnection');


  var SRD = pc.nativeSetRemoteDescription;

  SRD.implementation = function (o, sdp) {
    var s = sdp.description.value;
    console.log('Set remote description:' + sdp.description.value);
    SRD.call(this, o, sdp);

  };
  
  
  
  var co = pc.nativeCreateOffer;
  co.implementation = function (o, sdp) {
    
    var iClass = Java.use("org.webrtc.DataChannel$Init");
    var instance = iClass.$new();
    
    var d = this.createDataChannel("test", instance);

    console.log("create offer");
    co.call(this, o, sdp);

  };

 
  

});
"""





devices = frida.enumerate_devices()
device = 0

if len(sys.argv) < 2:
	for item in devices:
		print(item.name)
	exit()	

for item in devices:
	print(item.name)
	if sys.argv[1] == item.name:
		device = item

process = device.attach(package_name)
script = process.create_script(jscode)
script.on('message', on_message)
print('[*] Running CTF')
script.load()
sys.stdin.read()
